<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spotify å®æ—¶åˆ†æä»ªè¡¨ç›˜</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --spotify-green: #1DB954;
      --bg-primary: #0a0a0a;
      --bg-secondary: #1a1a1a;
      --bg-tertiary: #252525;
      --text-primary: #ffffff;
      --text-secondary: rgba(255, 255, 255, 0.7);
      --text-tertiary: rgba(255, 255, 255, 0.4);
      --border-color: rgba(255, 255, 255, 0.08);
      --success: #1DB954;
      --warning: #f59e0b;
      --danger: #ef4444;
      --info: #3b82f6;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      overflow-x: hidden;
    }

    /* é¡¶éƒ¨å¯¼èˆªæ  */
    .navbar {
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
      padding: 16px 0;
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(20px);
    }

    .navbar-content {
      max-width: 1800px;
      margin: 0 auto;
      padding: 0 32px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .brand-logo {
      width: 42px;
      height: 42px;
      background: linear-gradient(135deg, var(--spotify-green), #1ed760);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 20px rgba(29, 185, 84, 0.3);
    }

    .brand-logo svg {
      width: 24px;
      height: 24px;
      fill: white;
    }

    .brand-info h1 {
      font-size: 20px;
      font-weight: 700;
      letter-spacing: -0.5px;
    }

    .brand-info p {
      font-size: 13px;
      color: var(--text-tertiary);
      margin-top: 2px;
    }

    .navbar-actions {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .lang-switch {
      display: flex;
      gap: 4px;
      background: var(--bg-tertiary);
      padding: 4px;
      border-radius: 8px;
    }

    .lang-btn {
      padding: 6px 12px;
      background: transparent;
      border: none;
      color: var(--text-secondary);
      font-size: 13px;
      font-weight: 600;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .lang-btn:hover {
      color: var(--text-primary);
    }

    .lang-btn.active {
      background: var(--spotify-green);
      color: white;
    }

    .status-badge {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: rgba(29, 185, 84, 0.1);
      border: 1px solid rgba(29, 185, 84, 0.2);
      border-radius: 20px;
      font-size: 13px;
      font-weight: 500;
      color: var(--spotify-green);
    }

    .status-dot {
      width: 8px;
      height: 8px;
      background: var(--spotify-green);
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(29, 185, 84, 0.7); }
      50% { opacity: 0.8; box-shadow: 0 0 0 8px rgba(29, 185, 84, 0); }
    }

    /* ä¸»å®¹å™¨ */
    .container {
      max-width: 1800px;
      margin: 0 auto;
      padding: 32px;
    }

    /* åˆ†åŒºæ ‡é¢˜ */
    .section {
      margin-bottom: 48px;
    }

    .section-header {
      margin-bottom: 24px;
    }

    .section-title {
      font-size: 24px;
      font-weight: 800;
      letter-spacing: -0.5px;
      margin-bottom: 8px;
    }

    .section-subtitle {
      font-size: 14px;
      color: var(--text-tertiary);
    }

    /* ========== é¦–å±é‡ç‚¹æ•°æ®åŒº ========== */
    .hero-section {
      margin-bottom: 48px;
    }

    /* æ ¸å¿ƒæŒ‡æ ‡è¡Œ */
    .hero-main {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 20px;
      margin-bottom: 24px;
    }

    @media (max-width: 900px) {
      .hero-main {
        grid-template-columns: 1fr;
      }
    }

    /* å½“å‰å¬ä¼—å¤§å¡ç‰‡ */
    .current-card {
      background: linear-gradient(135deg, #1DB954, #1ed760);
      border-radius: 20px;
      padding: 32px;
      box-shadow: 0 10px 30px rgba(29, 185, 84, 0.3);
    }

    .current-label {
      font-size: 13px;
      font-weight: 600;
      color: rgba(255,255,255,0.9);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }

    .current-value {
      font-size: 56px;
      font-weight: 800;
      color: white;
      line-height: 1;
      margin-bottom: 8px;
    }

    .current-trend {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: rgba(255,255,255,0.2);
      border-radius: 20px;
      font-size: 13px;
      font-weight: 700;
      color: white;
    }

    /* æ¬¡è¦æŒ‡æ ‡å¡ç‰‡ */
    .secondary-card {
      background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
      border: 1px solid var(--border-color);
      border-radius: 20px;
      padding: 32px;
      position: relative;
      overflow: hidden;
    }

    .secondary-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--spotify-green), #1ed760);
    }

    .secondary-label {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 12px;
    }

    .secondary-value {
      font-size: 42px;
      font-weight: 800;
      color: var(--text-primary);
      line-height: 1;
      margin-bottom: 8px;
    }

    .secondary-subtitle {
      font-size: 13px;
      color: var(--text-tertiary);
    }

    /* æ•°æ®å¯¹æ¯”è¡¨æ ¼ */
    .comparison-table {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      overflow: hidden;
    }

    .comparison-header {
      display: grid;
      grid-template-columns: 100px repeat(3, 1fr);
      background: var(--bg-tertiary);
      border-bottom: 1px solid var(--border-color);
    }

    .comparison-header-cell {
      padding: 16px 12px;
      font-size: 12px;
      font-weight: 700;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      text-align: center;
    }

    .comparison-header-cell:first-child {
      text-align: left;
    }

    .comparison-row {
      display: grid;
      grid-template-columns: 100px repeat(3, 1fr);
      border-bottom: 1px solid var(--border-color);
    }

    .comparison-row:last-child {
      border-bottom: none;
    }

    .comparison-row:first-child .comparison-value {
      color: var(--spotify-green);
    }

    .comparison-cell {
      padding: 16px 12px;
      text-align: center;
    }

    .comparison-cell:first-child {
      text-align: left;
      font-size: 13px;
      font-weight: 600;
      color: var(--text-secondary);
    }

    .comparison-value {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
    }

    /* å¸‚åœºæ´å¯ŸåŒº */
    .market-insights {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 24px;
      margin-top: 24px;
    }

    .market-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
    }

    .market-title {
      font-size: 18px;
      font-weight: 700;
    }

    .market-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
    }

    .market-card {
      background: var(--bg-tertiary);
      border-radius: 12px;
      padding: 16px 20px;
      display: flex;
      align-items: flex-start;
      gap: 12px;
    }

    .market-icon {
      font-size: 24px;
      flex-shrink: 0;
    }

    .market-content {
      flex: 1;
    }

    .market-label {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 4px;
    }

    .market-detail {
      font-size: 13px;
      color: var(--text-secondary);
    }

    .market-detail strong {
      color: var(--spotify-green);
    }

    /* å…³é”®æŒ‡æ ‡ç½‘æ ¼ - ä¿ç•™ç”¨äºfallback */
    .key-metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
    }

    /* å½“å‰å¬ä¼—å¡ç‰‡ï¼ˆç‰¹æ®Šæ ·å¼ï¼‰ */
    .key-metric-card.primary {
      background: linear-gradient(135deg, #1DB954, #1ed760);
      border: none;
      box-shadow: 0 10px 30px rgba(29, 185, 84, 0.3);
    }

    .key-metric-card.primary::before {
      display: none;
    }

    .key-metric-card.primary .key-metric-label,
    .key-metric-card.primary .key-metric-value,
    .key-metric-card.primary .key-metric-subtitle,
    .key-metric-card.primary .key-metric-trend {
      color: white;
    }

    .key-metric-trend {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      font-weight: 600;
      margin-top: 8px;
    }

    .key-metric-trend-icon {
      font-size: 18px;
    }

    .key-metric-card {
      background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
      border: 1px solid var(--border-color);
      border-radius: 20px;
      padding: 32px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .key-metric-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 40px rgba(0,0,0,0.4);
      border-color: rgba(29, 185, 84, 0.3);
    }

    .key-metric-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--spotify-green), #1ed760);
    }

    .key-metric-label {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 12px;
    }

    .key-metric-value {
      font-size: 48px;
      font-weight: 800;
      line-height: 1;
      margin-bottom: 12px;
      letter-spacing: -2px;
    }

    .key-metric-subtitle {
      font-size: 14px;
      color: var(--text-tertiary);
    }

    .key-metric-trend {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: rgba(29, 185, 84, 0.15);
      border-radius: 20px;
      font-size: 13px;
      font-weight: 700;
      color: var(--spotify-green);
      margin-top: 12px;
    }

    .key-metric-trend.negative {
      background: rgba(239, 68, 68, 0.15);
      color: var(--danger);
    }

    /* ========== å›¾è¡¨åŒºåŸŸ ========== */
    .chart-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 20px;
      padding: 32px;
      margin-bottom: 24px;
    }

    .chart-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
    }

    .chart-title {
      font-size: 20px;
      font-weight: 700;
      letter-spacing: -0.5px;
    }

    .chart-subtitle {
      font-size: 13px;
      color: var(--text-tertiary);
      margin-top: 4px;
    }

    .time-selector {
      display: flex;
      gap: 6px;
      background: var(--bg-tertiary);
      padding: 4px;
      border-radius: 10px;
    }

    .time-btn,
    .chart-type-btn {
      padding: 8px 16px;
      background: transparent;
      border: none;
      color: var(--text-secondary);
      font-size: 13px;
      font-weight: 600;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .time-btn:hover,
    .chart-type-btn:hover {
      color: var(--text-primary);
    }

    .time-btn.active,
    .chart-type-btn.active {
      background: var(--spotify-green);
      color: white;
    }

    .chart-container {
      position: relative;
      height: 400px;
    }

    /* ========== è¯¦ç»†ç»Ÿè®¡åŒºåŸŸ ========== */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }

    .stat-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 24px;
      transition: all 0.3s ease;
    }

    .stat-card:hover {
      background: var(--bg-tertiary);
      border-color: rgba(29, 185, 84, 0.2);
    }

    .stat-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--border-color);
    }

    .stat-hour {
      font-size: 18px;
      font-weight: 700;
    }

    .stat-timezones {
      font-size: 11px;
      color: var(--text-secondary);
      margin-top: 4px;
      line-height: 1.4;
    }

    .stat-timezone {
      display: inline-block;
      margin-right: 8px;
    }

    /* æ—¶æ®µåˆ†æå¡ç‰‡ */
    .insights-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    .insight-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 20px;
      display: flex;
      gap: 16px;
      transition: all 0.3s ease;
    }

    .insight-card:hover {
      background: var(--bg-tertiary);
      border-color: rgba(29, 185, 84, 0.3);
    }

    .insight-card.highlight {
      background: linear-gradient(135deg, rgba(29, 185, 84, 0.15), rgba(29, 185, 84, 0.05));
      border-color: rgba(29, 185, 84, 0.3);
    }

    .insight-card.peak {
      border-left: 3px solid var(--spotify-green);
    }

    .insight-icon {
      font-size: 32px;
      flex-shrink: 0;
    }

    .insight-content {
      flex: 1;
    }

    .insight-title {
      font-size: 16px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .insight-detail {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }

    .insight-subdetail {
      font-size: 13px;
      color: var(--text-secondary);
      opacity: 0.8;
    }

    .insight-value {
      font-size: 13px;
      color: var(--spotify-green);
      font-weight: 600;
      margin-top: 8px;
    }

    .insight-tag {
      display: inline-block;
      padding: 2px 8px;
      background: rgba(29, 185, 84, 0.2);
      color: var(--spotify-green);
      border-radius: 10px;
      font-size: 11px;
      font-weight: 600;
      margin-left: 8px;
    }

    .insight-tag.low {
      background: rgba(239, 68, 68, 0.2);
      color: var(--danger);
    }

    .insight-summary {
      background: var(--bg-tertiary);
      border-radius: 16px;
      padding: 24px;
      margin-top: 24px;
    }

    .summary-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 16px;
    }

    .summary-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .summary-list li {
      padding: 12px 0;
      border-bottom: 1px solid var(--border-color);
      color: var(--text-secondary);
      font-size: 14px;
    }

    .summary-list li:last-child {
      border-bottom: none;
    }

    .summary-list strong {
      color: var(--spotify-green);
    }

    .stat-badge {
      padding: 4px 12px;
      background: rgba(29, 185, 84, 0.15);
      border-radius: 12px;
      font-size: 11px;
      font-weight: 700;
      color: var(--spotify-green);
      text-transform: uppercase;
    }

    .stat-badge.low {
      background: rgba(59, 130, 246, 0.15);
      color: var(--info);
    }

    .stat-content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .stat-item {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .stat-label {
      font-size: 11px;
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .stat-value {
      font-size: 24px;
      font-weight: 700;
    }

    .stat-change {
      font-size: 13px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .stat-change.positive {
      color: var(--success);
    }

    .stat-change.negative {
      color: var(--danger);
    }

    .stat-change.neutral {
      color: var(--text-tertiary);
    }

    /* ========== æ•°æ®åˆ†æåŒºåŸŸ ========== */
    .analysis-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 24px;
    }

    .analysis-card {
      background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
      border: 1px solid var(--border-color);
      border-radius: 20px;
      padding: 32px;
    }

    .analysis-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .analysis-subtitle {
      font-size: 13px;
      color: var(--text-tertiary);
      margin-bottom: 24px;
    }

    .analysis-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 0;
      border-bottom: 1px solid var(--border-color);
    }

    .analysis-row:last-child {
      border-bottom: none;
    }

    .analysis-metric {
      font-size: 14px;
      color: var(--text-secondary);
    }

    .analysis-value {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .analysis-number {
      font-size: 24px;
      font-weight: 700;
    }

    .analysis-trend {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 6px 12px;
      background: rgba(29, 185, 84, 0.15);
      border-radius: 20px;
      font-size: 13px;
      font-weight: 700;
      color: var(--spotify-green);
    }

    .analysis-trend.negative {
      background: rgba(239, 68, 68, 0.15);
      color: var(--danger);
    }

    /* æ“ä½œæŒ‰é’® */
    .actions-section {
      margin-top: 64px;
    }

    .actions-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
    }

    .action-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 16px 24px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      color: var(--text-primary);
      font-size: 14px;
      font-weight: 600;
      text-decoration: none;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .action-btn:hover {
      background: var(--bg-tertiary);
      border-color: var(--spotify-green);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(29, 185, 84, 0.2);
    }

    .action-btn.danger {
      border-color: rgba(239, 68, 68, 0.3);
    }

    .action-btn.danger:hover {
      border-color: var(--danger);
      box-shadow: 0 8px 20px rgba(239, 68, 68, 0.2);
    }

    .action-btn svg {
      width: 18px;
      height: 18px;
      fill: currentColor;
    }

    /* é¡µè„š */
    .footer {
      text-align: center;
      padding: 48px 32px;
      color: var(--text-tertiary);
      font-size: 13px;
      border-top: 1px solid var(--border-color);
      margin-top: 64px;
    }

    /* åŠ è½½åŠ¨ç”» */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 60px;
      flex-direction: column;
      gap: 16px;
    }

    .spinner {
      width: 48px;
      height: 48px;
      border: 4px solid rgba(29, 185, 84, 0.1);
      border-top-color: var(--spotify-green);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* é”™è¯¯æç¤º */
    .alert {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(239, 68, 68, 0.05));
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 16px;
      padding: 20px 24px;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .alert-icon {
      font-size: 28px;
    }

    .alert-content {
      flex: 1;
    }

    .alert-title {
      font-weight: 700;
      color: var(--danger);
      margin-bottom: 4px;
    }

    .alert-message {
      font-size: 13px;
      color: var(--text-secondary);
    }

    .alert-action {
      padding: 10px 20px;
      background: var(--danger);
      border: none;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .alert-action:hover {
      background: #dc2626;
      transform: translateY(-1px);
    }

    /* å“åº”å¼ */
    @media (max-width: 1200px) {
      .key-metrics {
        grid-template-columns: repeat(2, 1fr);
      }

      .analysis-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .container {
        padding: 20px;
      }

      .navbar-content {
        padding: 0 20px;
        flex-wrap: wrap;
        gap: 12px;
      }

      .primary-value {
        font-size: 64px;
      }

      .key-metric-value {
        font-size: 36px;
      }

      .key-metrics {
        grid-template-columns: 1fr;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>

  <!-- å¯¼èˆªæ  -->
  <nav class="navbar">
    <div class="navbar-content">
      <div class="brand">
        <div class="brand-logo">
          <svg viewBox="0 0 24 24"><path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"/></svg>
        </div>
        <div class="brand-info">
          <h1 data-i18n="app.title">å®æ—¶åˆ†æ</h1>
          <p data-i18n="app.subtitle">Spotify å¬ä¼—è¿½è¸ªä»ªè¡¨ç›˜</p>
        </div>
      </div>
      <div class="navbar-actions">
        <div class="lang-switch">
          <button class="lang-btn active" data-lang="zh">ä¸­æ–‡</button>
          <button class="lang-btn" data-lang="en">English</button>
        </div>
        <div class="status-badge" id="status-badge">
          <span class="status-dot"></span>
          <span data-i18n="status.live">å®æ—¶ç›‘æ§</span>
        </div>
      </div>
    </div>
  </nav>

  <!-- ä¸»å®¹å™¨ -->
  <div class="container">

    <!-- é”™è¯¯æç¤º -->
    <div id="error-alert" style="display: none;"></div>

    <!-- ========== ç¬¬ä¸€éƒ¨åˆ†ï¼šæ•°æ®æ¦‚è§ˆ ========== -->
    <section class="hero-section">
      <div class="section-header">
        <h2 class="section-title" data-i18n="section.overview">æ•°æ®æ¦‚è§ˆ</h2>
        <p class="section-subtitle" data-i18n="section.overviewDesc">å®æ—¶æ•°æ®ä¸å†å²å¯¹æ¯” <span style="opacity: 0.6; font-size: 12px;" data-i18n="timezone.utc">(UTCæ—¶åŒº)</span></p>
      </div>

      <!-- æ ¸å¿ƒæŒ‡æ ‡ -->
      <div id="hero-content">
        <div class="loading">
          <div class="spinner"></div>
          <p data-i18n="loading">åŠ è½½ä¸­...</p>
        </div>
      </div>
    </section>

    <!-- ========== ç¬¬äºŒéƒ¨åˆ†ï¼šå›¾è¡¨åŒºåŸŸ ========== -->
    <section class="section">
      <div class="section-header">
        <h2 class="section-title" data-i18n="section.charts">è¶‹åŠ¿å›¾è¡¨</h2>
        <p class="section-subtitle" data-i18n="section.chartsDesc">æ•°æ®å¯è§†åŒ–åˆ†æ</p>
      </div>

      <div class="chart-card">
        <div class="chart-header">
          <div>
            <div class="chart-title" data-i18n="chart.timeline">å¬ä¼—è¶‹åŠ¿</div>
            <div class="chart-subtitle" id="chart-subtitle" data-i18n="chart.timelineDesc">å®æ—¶å¬ä¼—æ•°é‡å˜åŒ–</div>
          </div>
          <div style="display: flex; gap: 12px; align-items: center;">
            <div class="time-selector">
              <button class="time-btn active" data-range="720" data-i18n="time.1h">1å°æ—¶</button>
              <button class="time-btn" data-range="4320" data-i18n="time.6h">6å°æ—¶</button>
              <button class="time-btn" data-range="8640" data-i18n="time.12h">12å°æ—¶</button>
              <button class="time-btn" data-range="17280" data-i18n="time.24h">24å°æ—¶</button>
              <button class="time-btn" data-range="0" data-i18n="time.all">å…¨éƒ¨</button>
            </div>
            <div class="time-selector">
              <button class="chart-type-btn active" data-type="raw" data-i18n="chart.raw">åŸå§‹</button>
              <button class="chart-type-btn" data-type="smooth" data-i18n="chart.smooth">å¹³æ»‘</button>
            </div>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="main-chart"></canvas>
        </div>
      </div>
    </section>


    <!-- ========== å¿«æ·æ“ä½œ ========== -->
    <section class="actions-section">
      <div class="section-header">
        <h2 class="section-title" data-i18n="section.actions">å¿«æ·æ“ä½œ</h2>
      </div>
      <div class="actions-grid">
        <a href="/api/stats" target="_blank" class="action-btn">
          <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/></svg>
          <span data-i18n="action.stats">ç»Ÿè®¡ API</span>
        </a>
        <a href="/api/data?limit=100" target="_blank" class="action-btn">
          <svg viewBox="0 0 24 24"><path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 9h-4v4h-2v-4H9V9h4V5h2v4h4v2z"/></svg>
          <span data-i18n="action.recent">æœ€è¿‘æ•°æ®</span>
        </a>
        <a href="/api/download/csv" class="action-btn">
          <svg viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
          <span data-i18n="action.export">å¯¼å‡º CSV</span>
        </a>
        <button onclick="handleLogin()" class="action-btn">
          <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/></svg>
          <span data-i18n="action.login">é‡æ–°ç™»å½•</span>
        </button>
        <button onclick="handleClearData()" class="action-btn danger">
          <svg viewBox="0 0 24 24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>
          <span data-i18n="action.clear">æ¸…ç©ºæ•°æ®</span>
        </button>
      </div>
    </section>

    <!-- é¡µè„š -->
    <footer class="footer" data-i18n="footer">
      Spotify å®æ—¶åˆ†æ Â· Powered by Claude Code
    </footer>
  </div>

  <script>
    // ========== å›½é™…åŒ– ==========
    const i18n = {
      zh: {
        'app.title': 'å®æ—¶åˆ†æ',
        'app.subtitle': 'Spotify å¬ä¼—è¿½è¸ªä»ªè¡¨ç›˜',
        'status.live': 'å®æ—¶ç›‘æ§',
        'status.error': 'çŠ¶æ€å¼‚å¸¸',
        'loading': 'åŠ è½½ä¸­...',
        'section.overview': 'æ ¸å¿ƒæ¦‚è§ˆ',
        'section.overviewDesc': 'æœ€é‡è¦çš„å®æ—¶æ•°æ®ä¸€ç›®äº†ç„¶',
        'timezone.utc': '(UTCæ—¶åŒº)',
        'section.charts': 'è¶‹åŠ¿å›¾è¡¨',
        'section.chartsDesc': 'æ•°æ®å¯è§†åŒ–åˆ†æ',
        'section.hourlyStats': 'æ—¶æ®µåˆ†æ',
        'section.hourlyStatsDesc': 'å„æ—¶åŒºé«˜å³°ä½è°·æ—¶æ®µæ´å¯Ÿ',
        'section.analysis': 'æ·±åº¦åˆ†æ',
        'section.analysisDesc': 'ä¸å†å²æ•°æ®å¯¹æ¯”åˆ†æ',
        'section.actions': 'å¿«æ·æ“ä½œ',
        'chart.timeline': 'å¬ä¼—è¶‹åŠ¿',
        'chart.timelineDesc': 'å®æ—¶å¬ä¼—æ•°é‡å˜åŒ–',
        'chart.raw': 'åŸå§‹',
        'chart.smooth': 'å¹³æ»‘',
        'time.1h': '1å°æ—¶',
        'time.6h': '6å°æ—¶',
        'time.12h': '12å°æ—¶',
        'time.24h': '24å°æ—¶',
        'time.all': 'å…¨éƒ¨',
        'action.stats': 'ç»Ÿè®¡ API',
        'action.recent': 'æœ€è¿‘æ•°æ®',
        'action.export': 'å¯¼å‡º CSV',
        'action.login': 'é‡æ–°ç™»å½•',
        'action.clear': 'æ¸…ç©ºæ•°æ®',
        'footer': 'Spotify å®æ—¶åˆ†æ Â· Powered by Claude Code',
        'hero.current': 'å½“å‰å¬ä¼—',
        'hero.todayAvg': 'ä»Šæ—¥å¹³å‡',
        'hero.prediction': 'é¢„æµ‹æ’­æ”¾é‡',
        'hero.todayPrediction': 'ä»Šæ—¥é¢„æµ‹æ’­æ”¾',
        'hero.peak': 'ä»Šæ—¥å³°å€¼',
        'hero.todayPeak': 'ä»Šæ—¥å³°å€¼',
        'hero.vs1h': 'å¯¹æ¯”1å°æ—¶å‰',
        'hero.predictedStreams': 'é¢„è®¡ä»Šæ—¥æ’­æ”¾',
        'hero.based': 'åŸºäºå¹³å‡å¬ä¼—æ•°ä¼°ç®—',
        'hourly.average': 'å¹³å‡',
        'hourly.vsHistory': 'å¯¹æ¯”å†å²',
        'hourly.peak': 'é«˜å³°',
        'hourly.low': 'ä½è°·',
        'hourly.listeners': 'å¬ä¼—',
        'hourly.noData': 'æš‚æ— æ•°æ®',
        'analysis.yesterday': 'å¯¹æ¯”æ˜¨å¤©',
        'analysis.yesterdayDesc': 'ä¸å‰ä¸€å¤©åŒæ—¶æ®µå¯¹æ¯”',
        'analysis.lastWeek': 'å¯¹æ¯”ä¸Šå‘¨',
        'analysis.lastWeekDesc': 'ä¸7å¤©å‰åŒæ—¶æ®µå¯¹æ¯”',
        'analysis.overall': 'æ•´ä½“ç»Ÿè®¡',
        'analysis.overallDesc': 'å…¨éƒ¨å†å²æ•°æ®æ±‡æ€»',
        'analysis.thisWeek': 'æœ¬å‘¨ç»Ÿè®¡',
        'analysis.thisWeekDesc': 'æœ¬å‘¨(UTC)æ•°æ®æ±‡æ€»',
        'analysis.thisMonth': 'æœ¬æœˆç»Ÿè®¡',
        'analysis.thisMonthDesc': 'æœ¬æœˆ(UTC)æ•°æ®æ±‡æ€»',
        'analysis.currentAvg': 'å½“å‰å¹³å‡',
        'analysis.yesterdayAvg': 'æ˜¨æ—¥å¹³å‡',
        'analysis.lastWeekAvg': 'ä¸Šå‘¨å¹³å‡',
        'analysis.overallAvg': 'æ•´ä½“å¹³å‡',
        'analysis.weekAvg': 'æœ¬å‘¨å¹³å‡',
        'analysis.monthAvg': 'æœ¬æœˆå¹³å‡',
        'analysis.weekPeak': 'æœ¬å‘¨å³°å€¼',
        'analysis.monthPeak': 'æœ¬æœˆå³°å€¼',
        'analysis.overallPeak': 'å†å²å³°å€¼',
        'analysis.overallMin': 'å†å²æœ€ä½',
        'analysis.change': 'å˜åŒ–',
        'listeners': 'å¬ä¼—',
        'na': 'æš‚æ— æ•°æ®'
      },
      en: {
        'app.title': 'Real-Time Analytics',
        'app.subtitle': 'Spotify Listener Tracking Dashboard',
        'status.live': 'Live Monitoring',
        'status.error': 'Error',
        'loading': 'Loading...',
        'section.overview': 'Overview',
        'section.overviewDesc': 'Key metrics at a glance',
        'timezone.utc': '(UTC Timezone)',
        'section.charts': 'Charts',
        'section.chartsDesc': 'Data visualization',
        'section.hourlyStats': 'Time Zone Analysis',
        'section.hourlyStatsDesc': 'Peak and low hours by timezone',
        'section.analysis': 'Deep Analysis',
        'section.analysisDesc': 'Historical data comparison',
        'section.actions': 'Quick Actions',
        'chart.timeline': 'Listener Trends',
        'chart.timelineDesc': 'Real-time listener count changes',
        'chart.raw': 'Raw',
        'chart.smooth': 'Smooth',
        'time.1h': '1 Hour',
        'time.6h': '6 Hours',
        'time.12h': '12 Hours',
        'time.24h': '24 Hours',
        'time.all': 'All',
        'action.stats': 'Stats API',
        'action.recent': 'Recent Data',
        'action.export': 'Export CSV',
        'action.login': 'Re-login',
        'action.clear': 'Clear Data',
        'footer': 'Spotify Real-Time Analytics Â· Powered by Claude Code',
        'hero.current': 'Current Listeners',
        'hero.todayAvg': 'Today Average',
        'hero.prediction': 'Predicted Streams',
        'hero.todayPrediction': 'Today Predicted Streams',
        'hero.peak': 'Peak',
        'hero.todayPeak': 'Today Peak',
        'hero.vs1h': 'vs 1 hour ago',
        'hero.predictedStreams': 'Predicted Daily Streams',
        'hero.based': 'Based on average listener count',
        'hourly.average': 'Average',
        'hourly.vsHistory': 'vs History',
        'hourly.peak': 'Peak',
        'hourly.low': 'Low',
        'hourly.listeners': 'listeners',
        'hourly.noData': 'No data',
        'analysis.yesterday': 'vs Yesterday',
        'analysis.yesterdayDesc': 'Comparison with previous day',
        'analysis.lastWeek': 'vs Last Week',
        'analysis.lastWeekDesc': 'Comparison with 7 days ago',
        'analysis.overall': 'Overall Stats',
        'analysis.overallDesc': 'All historical data summary',
        'analysis.thisWeek': 'This Week',
        'analysis.thisWeekDesc': 'This week (UTC) data summary',
        'analysis.thisMonth': 'This Month',
        'analysis.thisMonthDesc': 'This month (UTC) data summary',
        'analysis.currentAvg': 'Current Average',
        'analysis.yesterdayAvg': 'Yesterday Average',
        'analysis.lastWeekAvg': 'Last Week Average',
        'analysis.overallAvg': 'Overall Average',
        'analysis.weekAvg': 'Week Average',
        'analysis.monthAvg': 'Month Average',
        'analysis.weekPeak': 'Week Peak',
        'analysis.monthPeak': 'Month Peak',
        'analysis.overallPeak': 'All-time Peak',
        'analysis.overallMin': 'All-time Low',
        'analysis.change': 'Change',
        'listeners': 'listeners',
        'na': 'N/A'
      }
    };

    let currentLang = 'zh';

    function t(key) {
      return i18n[currentLang][key] || key;
    }

    function updateLanguage(lang) {
      currentLang = lang;
      document.documentElement.lang = lang;

      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        el.textContent = t(key);
      });

      document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.lang === lang);
      });

      refresh();
    }

    document.querySelectorAll('.lang-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        updateLanguage(btn.dataset.lang);
      });
    });

    // ========== æ•°æ®å’Œå›¾è¡¨ ==========
    let mainChart;
    let currentRange = 720;
    let chartType = 'raw'; // 'raw' æˆ– 'smooth'
    let allData = [];
    let processedData = []; // å›¾è¡¨ä½¿ç”¨çš„å¤„ç†åæ•°æ®

    document.querySelectorAll('.time-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentRange = parseInt(btn.dataset.range);
        loadMainChart();
      });
    });

    document.querySelectorAll('.chart-type-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.chart-type-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        chartType = btn.dataset.type;
        loadMainChart();
      });
    });

    // åŠ è½½æ•°æ®æ¦‚è§ˆï¼ˆæ•´åˆæ‰€æœ‰æ•°æ®å±•ç¤ºï¼Œç‹¬ç«‹è·å–æ•°æ®ï¼‰
    async function loadHeroSection() {
      try {
        // è·å–ç»Ÿè®¡æ•°æ®å’Œè¶³å¤Ÿå¤šçš„å†å²æ•°æ®
        const [statsRes, heroDataRes, hourlyRes] = await Promise.all([
          fetch('/api/stats'),
          fetch('/api/data?limit=250000'),
          fetch('/api/analytics/hourly')
        ]);

        const stats = await statsRes.json();
        const heroData = await heroDataRes.json();
        const hourlyData = await hourlyRes.json();

        if (!stats || stats.totalRecords === 0) {
          document.getElementById('hero-content').innerHTML = `<div class="loading">${t('na')}</div>`;
          return;
        }

        const current = stats.latestCount;
        const nowUTC = new Date();

        // === ä»Šæ—¥æ•°æ® (UTC) ===
        const todayStartUTC = new Date(Date.UTC(nowUTC.getUTCFullYear(), nowUTC.getUTCMonth(), nowUTC.getUTCDate(), 0, 0, 0, 0));
        const todayData = heroData.filter(d => new Date(d.timestamp) >= todayStartUTC);
        const todayValues = todayData.map(d => d.listenerCount);
        const todayAvg = todayValues.length > 0 ? todayValues.reduce((a, b) => a + b, 0) / todayValues.length : current;
        const todayPeak = todayValues.length > 0 ? Math.max(...todayValues) : current;

        // ä»Šæ—¥é¢„æµ‹æ’­æ”¾é‡
        const hoursElapsedUTC = (nowUTC - todayStartUTC) / (1000 * 60 * 60);
        const predictedStreams = hoursElapsedUTC > 0 ? Math.round((todayAvg * 24 * 60) / 3) : 0;

        // å¯¹æ¯”1å°æ—¶å‰
        const data1h = heroData.slice(-720);
        const avg1h = data1h.length > 0 ? data1h.reduce((s, d) => s + d.listenerCount, 0) / data1h.length : 0;
        const trend1h = avg1h > 0 ? ((current - avg1h) / avg1h * 100).toFixed(1) : 0;
        const isUp = parseFloat(trend1h) > 0;

        // === æœ¬å‘¨æ•°æ® (UTC) ===
        const weekStartUTC = new Date(Date.UTC(nowUTC.getUTCFullYear(), nowUTC.getUTCMonth(), nowUTC.getUTCDate() - nowUTC.getUTCDay()));
        const thisWeekData = heroData.filter(d => new Date(d.timestamp) >= weekStartUTC);
        const thisWeekValues = thisWeekData.map(d => d.listenerCount);
        const thisWeekAvg = thisWeekValues.length > 0 ? thisWeekValues.reduce((a, b) => a + b, 0) / thisWeekValues.length : null;
        const thisWeekPeak = thisWeekValues.length > 0 ? Math.max(...thisWeekValues) : null;

        // === æœ¬æœˆæ•°æ® (UTC) ===
        const monthStartUTC = new Date(Date.UTC(nowUTC.getUTCFullYear(), nowUTC.getUTCMonth(), 1));
        const thisMonthData = heroData.filter(d => new Date(d.timestamp) >= monthStartUTC);
        const thisMonthValues = thisMonthData.map(d => d.listenerCount);
        const thisMonthAvg = thisMonthValues.length > 0 ? thisMonthValues.reduce((a, b) => a + b, 0) / thisMonthValues.length : null;
        const thisMonthPeak = thisMonthValues.length > 0 ? Math.max(...thisMonthValues) : null;

        // === å…¨éƒ¨æ•°æ® ===
        const allValues = heroData.map(d => d.listenerCount);
        const overallAvg = allValues.reduce((a, b) => a + b, 0) / allValues.length;
        const overallPeak = Math.max(...allValues);

        // === è®¡ç®—å„æ—¶æœŸé¢„æµ‹æ¯æ—¥æ’­æ”¾é‡ ===
        // å…¬å¼: å¹³å‡å¬ä¼— * 24å°æ—¶ * 60åˆ†é’Ÿ / 3åˆ†é’Ÿ(æ¯é¦–æ­Œ) = æ¯æ—¥æ’­æ”¾
        const calcDailyStreams = (avg) => avg ? Math.round((avg * 24 * 60) / 3) : null;
        const thisWeekDailyStreams = calcDailyStreams(thisWeekAvg);
        const thisMonthDailyStreams = calcDailyStreams(thisMonthAvg);
        const overallDailyStreams = calcDailyStreams(overallAvg);

        // === å¸‚åœºæ´å¯Ÿ ===
        let marketInsightsHtml = '';
        if (hourlyData.length > 0) {
          const overallHourlyAvg = hourlyData.reduce((s, d) => s + d.avgCount, 0) / hourlyData.length;
          const sorted = [...hourlyData].sort((a, b) => b.avgCount - a.avgCount);
          const peakHours = sorted.slice(0, 3);
          const lowHours = sorted.slice(-3).reverse();

          // åˆ†æä¸»åŠ›å¸‚åœº
          const peakUTCHours = peakHours.map(h => h.hour);
          let mainMarket = '';
          let mainMarketIcon = 'ğŸŒ';

          // æ ¹æ®UTCé«˜å³°æ—¶é—´æ¨æ–­ä¸»åŠ›å¸‚åœº
          const avgPeakHour = peakUTCHours.reduce((a, b) => a + b, 0) / peakUTCHours.length;
          if (avgPeakHour >= 0 && avgPeakHour <= 6) {
            mainMarket = currentLang === 'zh' ? 'åŒ—ç¾æ™šé—´ç”¨æˆ·ä¸ºä¸»' : 'Primarily North American evening users';
            mainMarketIcon = 'ğŸ‡ºğŸ‡¸';
          } else if (avgPeakHour >= 10 && avgPeakHour <= 16) {
            mainMarket = currentLang === 'zh' ? 'äºšå¤ªåœ°åŒºç”¨æˆ·ä¸ºä¸»' : 'Primarily Asia-Pacific users';
            mainMarketIcon = 'ğŸŒ';
          } else if (avgPeakHour >= 17 && avgPeakHour <= 23) {
            mainMarket = currentLang === 'zh' ? 'æ¬§æ´²æ™šé—´ç”¨æˆ·ä¸ºä¸»' : 'Primarily European evening users';
            mainMarketIcon = 'ğŸ‡ªğŸ‡º';
          } else {
            mainMarket = currentLang === 'zh' ? 'å…¨çƒåˆ†å¸ƒå‡åŒ€' : 'Evenly distributed globally';
          }

          const peakVsAvg = ((peakHours[0].avgCount / overallHourlyAvg - 1) * 100).toFixed(0);
          const lowVsAvg = ((1 - lowHours[0].avgCount / overallHourlyAvg) * 100).toFixed(0);

          marketInsightsHtml = `
            <div class="market-insights">
              <div class="market-header">
                <span style="font-size: 24px;">ğŸ¯</span>
                <span class="market-title">${currentLang === 'zh' ? 'å¸‚åœºæ´å¯Ÿ' : 'Market Insights'}</span>
              </div>
              <div class="market-grid">
                <div class="market-card">
                  <div class="market-icon">ğŸ“ˆ</div>
                  <div class="market-content">
                    <div class="market-label">${currentLang === 'zh' ? 'é«˜å³°æ—¶æ®µ' : 'Peak Hours'}</div>
                    <div class="market-detail">UTC ${peakHours.map(h => h.hour + ':00').join(', ')} Â· <strong>+${peakVsAvg}%</strong> ${currentLang === 'zh' ? 'é«˜äºå¹³å‡' : 'above avg'}</div>
                  </div>
                </div>
                <div class="market-card">
                  <div class="market-icon">ğŸ“‰</div>
                  <div class="market-content">
                    <div class="market-label">${currentLang === 'zh' ? 'ä½è°·æ—¶æ®µ' : 'Low Hours'}</div>
                    <div class="market-detail">UTC ${lowHours.map(h => h.hour + ':00').join(', ')} Â· <strong>-${lowVsAvg}%</strong> ${currentLang === 'zh' ? 'ä½äºå¹³å‡' : 'below avg'}</div>
                  </div>
                </div>
                <div class="market-card">
                  <div class="market-icon">${mainMarketIcon}</div>
                  <div class="market-content">
                    <div class="market-label">${currentLang === 'zh' ? 'ä¸»åŠ›å¸‚åœºæ¨æµ‹' : 'Primary Market'}</div>
                    <div class="market-detail">${mainMarket}</div>
                  </div>
                </div>
                <div class="market-card">
                  <div class="market-icon">â°</div>
                  <div class="market-content">
                    <div class="market-label">${currentLang === 'zh' ? 'æœ€ä½³å‘å¸ƒæ—¶é—´' : 'Best Release Time'}</div>
                    <div class="market-detail">UTC <strong>${peakHours[0].hour}:00</strong> (${currentLang === 'zh' ? 'å¬ä¼—æœ€æ´»è·ƒ' : 'peak activity'})</div>
                  </div>
                </div>
              </div>
            </div>
          `;
        }

        // æ¸²æŸ“å®Œæ•´çš„æ•°æ®æ¦‚è§ˆ
        document.getElementById('hero-content').innerHTML = `
          <!-- æ ¸å¿ƒæŒ‡æ ‡è¡Œ -->
          <div class="hero-main">
            <div class="current-card">
              <div class="current-label">${t('hero.current')}</div>
              <div class="current-value">${current.toLocaleString()}</div>
              <div class="current-trend">
                <span>${isUp ? 'â†—' : 'â†˜'}</span>
                <span>${Math.abs(trend1h)}% ${t('hero.vs1h')}</span>
              </div>
            </div>
            <div class="secondary-card">
              <div class="secondary-label">${t('hero.todayPeak')}</div>
              <div class="secondary-value">${todayPeak.toLocaleString()}</div>
              <div class="secondary-subtitle">${currentLang === 'zh' ? 'ä»Šæ—¥æœ€é«˜' : 'Today\'s highest'}</div>
            </div>
            <div class="secondary-card">
              <div class="secondary-label">${t('hero.todayPrediction')}</div>
              <div class="secondary-value">${predictedStreams.toLocaleString()}</div>
              <div class="secondary-subtitle">${t('hero.based')}</div>
            </div>
          </div>

          <!-- æ•°æ®å¯¹æ¯”è¡¨æ ¼ -->
          <div class="comparison-table">
            <div class="comparison-header">
              <div class="comparison-header-cell"></div>
              <div class="comparison-header-cell">${currentLang === 'zh' ? 'å¹³å‡' : 'Average'}</div>
              <div class="comparison-header-cell">${currentLang === 'zh' ? 'å³°å€¼' : 'Peak'}</div>
              <div class="comparison-header-cell">${currentLang === 'zh' ? 'é¢„æµ‹æ—¥æ’­' : 'Est. Daily'}</div>
            </div>
            <div class="comparison-row">
              <div class="comparison-cell">${currentLang === 'zh' ? 'ä»Šæ—¥' : 'Today'}</div>
              <div class="comparison-cell"><span class="comparison-value">${todayAvg.toFixed(1)}</span></div>
              <div class="comparison-cell"><span class="comparison-value">${todayPeak.toLocaleString()}</span></div>
              <div class="comparison-cell"><span class="comparison-value">${predictedStreams.toLocaleString()}</span></div>
            </div>
            <div class="comparison-row">
              <div class="comparison-cell">${currentLang === 'zh' ? 'æœ¬å‘¨' : 'This Week'}</div>
              <div class="comparison-cell"><span class="comparison-value">${thisWeekAvg ? thisWeekAvg.toFixed(1) : '-'}</span></div>
              <div class="comparison-cell"><span class="comparison-value">${thisWeekPeak ? thisWeekPeak.toLocaleString() : '-'}</span></div>
              <div class="comparison-cell"><span class="comparison-value">${thisWeekDailyStreams ? thisWeekDailyStreams.toLocaleString() : '-'}</span></div>
            </div>
            <div class="comparison-row">
              <div class="comparison-cell">${currentLang === 'zh' ? 'æœ¬æœˆ' : 'This Month'}</div>
              <div class="comparison-cell"><span class="comparison-value">${thisMonthAvg ? thisMonthAvg.toFixed(1) : '-'}</span></div>
              <div class="comparison-cell"><span class="comparison-value">${thisMonthPeak ? thisMonthPeak.toLocaleString() : '-'}</span></div>
              <div class="comparison-cell"><span class="comparison-value">${thisMonthDailyStreams ? thisMonthDailyStreams.toLocaleString() : '-'}</span></div>
            </div>
            <div class="comparison-row">
              <div class="comparison-cell">${currentLang === 'zh' ? 'å…¨éƒ¨' : 'All Time'}</div>
              <div class="comparison-cell"><span class="comparison-value">${overallAvg.toFixed(1)}</span></div>
              <div class="comparison-cell"><span class="comparison-value">${overallPeak.toLocaleString()}</span></div>
              <div class="comparison-cell"><span class="comparison-value">${overallDailyStreams.toLocaleString()}</span></div>
            </div>
          </div>

          ${marketInsightsHtml}
        `;
      } catch (e) {
        console.error('Failed to load hero section:', e);
      }
    }

    // åŠ è½½ä¸»å›¾è¡¨
    async function loadMainChart() {
      try {
        const limit = currentRange === 0 ? 10000 : currentRange;
        const res = await fetch('/api/data?limit=' + limit);
        allData = await res.json();

        if (allData.length === 0) return;

        processedData = allData;

        // å¹³æ»‘æ¨¡å¼ï¼šæ•°æ®èšåˆ
        if (chartType === 'smooth') {
          const aggregateSize = currentRange === 720 ? 12 :      // 1h: æ¯åˆ†é’Ÿ (12ä¸ªç‚¹)
                                currentRange === 4320 ? 60 :     // 6h: æ¯5åˆ†é’Ÿ (60ä¸ªç‚¹)
                                currentRange === 8640 ? 120 :    // 12h: æ¯10åˆ†é’Ÿ (120ä¸ªç‚¹)
                                currentRange === 17280 ? 240 :   // 24h: æ¯20åˆ†é’Ÿ (240ä¸ªç‚¹)
                                60;                              // é»˜è®¤: æ¯5åˆ†é’Ÿ

          processedData = [];
          for (let i = 0; i < allData.length; i += aggregateSize) {
            const chunk = allData.slice(i, i + aggregateSize);
            const avgCount = chunk.reduce((sum, d) => sum + d.listenerCount, 0) / chunk.length;
            processedData.push({
              timestamp: chunk[Math.floor(chunk.length / 2)].timestamp,
              listenerCount: avgCount
            });
          }
        }

        const labels = processedData.map(d => {
          const date = new Date(d.timestamp);
          return currentRange >= 8640 || currentRange === 0
            ? date.toLocaleString(currentLang === 'zh' ? 'zh-CN' : 'en-US', {month:'short', day:'numeric', hour:'numeric', minute:'numeric'})
            : date.toLocaleTimeString(currentLang === 'zh' ? 'zh-CN' : 'en-US', {hour: '2-digit', minute: '2-digit'});
        });
        const values = processedData.map(d => d.listenerCount);

        const ctx = document.getElementById('main-chart').getContext('2d');

        if (!mainChart) {
          mainChart = new Chart(ctx, {
            type: 'line',
            data: {
              labels,
              datasets: [{
                data: values,
                borderColor: '#1DB954',
                borderWidth: 3,
                backgroundColor: (context) => {
                  const ctx = context.chart.ctx;
                  const gradient = ctx.createLinearGradient(0, 0, 0, 400);
                  gradient.addColorStop(0, 'rgba(29, 185, 84, 0.4)');
                  gradient.addColorStop(1, 'rgba(29, 185, 84, 0)');
                  return gradient;
                },
                fill: true,
                tension: chartType === 'smooth' ? 0.4 : 0.1,
                pointRadius: 0,
                pointHoverRadius: 8,
                pointHoverBackgroundColor: '#1DB954',
                pointHoverBorderColor: '#fff',
                pointHoverBorderWidth: 3
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              interaction: { intersect: false, mode: 'index' },
              plugins: {
                legend: { display: false },
                tooltip: {
                  backgroundColor: 'rgba(0, 0, 0, 0.9)',
                  titleColor: '#1DB954',
                  bodyColor: '#fff',
                  titleFont: { size: 16, weight: '700' },
                  bodyFont: { size: 13, weight: '500' },
                  padding: 12,
                  displayColors: false,
                  callbacks: {
                    title: (items) => {
                      if (!items.length) return '';
                      return items[0].parsed.y.toLocaleString() + ' ' + t('listeners');
                    },
                    label: (ctx) => {
                      const idx = ctx.dataIndex;
                      const dataPoint = processedData[idx];
                      if (!dataPoint) return '';

                      const date = new Date(dataPoint.timestamp);
                      const timeStr = date.toLocaleString(currentLang === 'zh' ? 'zh-CN' : 'en-US', {
                        month: 'short',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit',
                        timeZone: 'UTC'
                      });
                      return timeStr + ' UTC';
                    }
                  }
                }
              },
              scales: {
                y: {
                  beginAtZero: false,
                  grid: { color: 'rgba(255, 255, 255, 0.05)' },
                  ticks: {
                    color: 'rgba(255, 255, 255, 0.5)',
                    callback: function(value) {
                      return Number.isInteger(value) ? value : '';
                    }
                  }
                },
                x: {
                  grid: { display: false },
                  ticks: { color: 'rgba(255, 255, 255, 0.5)', maxTicksLimit: 12 }
                }
              }
            }
          });
        } else {
          mainChart.data.labels = labels;
          mainChart.data.datasets[0].data = values;
          mainChart.data.datasets[0].tension = chartType === 'smooth' ? 0.4 : 0.1;
          mainChart.update('none');
        }
      } catch (e) {
        console.error('Failed to load main chart:', e);
      }
    }

    // æ£€æŸ¥çŠ¶æ€
    async function checkStatus() {
      try {
        const res = await fetch('/api/status');
        const status = await res.json();

        const badge = document.getElementById('status-badge');
        const alertDiv = document.getElementById('error-alert');

        if (status.errorMessage) {
          badge.innerHTML = `<span class="status-dot" style="background: #ef4444;"></span><span>${t('status.error')}</span>`;
          alertDiv.style.display = 'flex';
          alertDiv.className = 'alert';
          alertDiv.innerHTML = `
            <div class="alert-icon">ğŸš¨</div>
            <div class="alert-content">
              <div class="alert-title">${status.errorMessage}</div>
              <div class="alert-message">Last success: ${status.lastSuccess ? new Date(status.lastSuccess).toLocaleString() : 'Never'}</div>
            </div>
            <button class="alert-action" onclick="handleLogin()">${t('action.login')}</button>
          `;
        } else {
          badge.innerHTML = `<span class="status-dot"></span><span>${t('status.live')}</span>`;
          alertDiv.style.display = 'none';
        }
      } catch (e) {
        console.error('Failed to check status:', e);
      }
    }

    // ç™»å½•å¤„ç†
    function handleLogin() {
      alert('Login feature - please implement based on your authentication method');
    }

    // æ¸…ç©ºæ•°æ®
    async function handleClearData() {
      const confirmed = confirm('âš ï¸ Warning: This will permanently delete all historical data!\n\nAre you sure you want to clear the database?\n\nRecommended: Download CSV backup first.');
      if (!confirmed) return;

      const doubleConfirm = confirm('Final confirmation: Do you really want to delete all data?\n\nThis action cannot be undone!');
      if (!doubleConfirm) return;

      try {
        const res = await fetch('/api/clear-data', { method: 'POST' });
        const data = await res.json();

        if (data.success) {
          alert('âœ… ' + data.message);
          await refresh();
        } else {
          alert('âŒ Failed: ' + data.message);
        }
      } catch (e) {
        alert('âŒ Request failed: ' + e.message);
      }
    }

    // åˆ·æ–°æ‰€æœ‰æ•°æ®
    async function refresh() {
      await Promise.all([
        loadHeroSection(),  // ç‹¬ç«‹åˆ·æ–°ä»Šæ—¥æ•°æ®
        loadMainChart(),
        checkStatus()
      ]);
    }

    // åˆå§‹åŒ–
    async function init() {
      await refresh();
    }

    // è‡ªåŠ¨åˆ·æ–°ï¼ˆæ¯5ç§’ï¼‰
    init();
    setInterval(refresh, 5000);
  </script>

</body>
</html>
